class Song{constructor(e){this.file=e,this.url=URL.createObjectURL(this.file)}}class SongList{constructor(){this.list=[],this.selectedSongIndex=-1,this.selectedPage=0,this.pagecount=1,this.disabled=!1,this.keylisten=!0}init(){$(".card.empty span").text(emptyCardText),$("#filebrowser").change(songlist.processFiles);for(let e=0;e<9;e++)$("#page div.col-4[name=placeholder_"+e+"]").contextmenu(function(){let e=$(this).attr("name"),t=$("#page div.col-4[name="+$(this).attr("name")+"] h6").text();songlist.rightclick(event,t,e)})}selectFiles(){$("#filebrowser").click()}processFiles(e){let t=e.target.files;for(var a,s=0;a=t[s];s++)songlist.add(new Song(a));songlist.update()}add(e){return"Song"===e.constructor.name&&this.list.push(e)}delete(e){return this.list.splice(e,1)}empty(){for(let e=0;e<9;e++)$("#page div.col-4[name=placeholder_"+e+"]").html(`<div class="card empty"><div class="card-body" onclick="songlist.selectFiles();"><span>${emptyCardText}</span></div></div>`)}rightclick(e,t,a){if(e.preventDefault(),$("#page div.col-4[name="+a+"] .card").hasClass("empty"))return!1;RenameModal.selected={placeholder:a,filename:t},RenameModal.open(),console.log(e),console.log(name)}update(){this.pagecount=Math.ceil(this.list.length/9),0==this.pagecount&&(pagecount=1),this.empty();let e=9*this.selectedPage,t=songlist.list.slice(e,e+9);for(var a,s=0;a=t[s];s++)$("#page div.col-4[name=placeholder_"+s+"]").html(`<div class="card song"><div class="card-body" onclick="songlist.selectPlaceholder(${s});"><span>${s+1}</span><h5 class="card-title">${Storage.getSongName(a.file.name)}</h5><h6 class="card-subtitle mb-2 text-muted">${a.file.name}</h6><p class="card-text">duration</p></div></div>`);$("#page #pagebar #currentPage").text(`${this.selectedPage+1} / ${this.pagecount}`),this.selectedSongIndex>=e&&this.selectedSongIndex<e+9&&$(`#page div.col-4[name=placeholder_${this.selectedSongIndex%9}] .card`).addClass("selected")}selectSong(e){if(e<0&&(e=songlist.list.length-1),e==songlist.list.length&&(e=0),this.selectedSongIndex==e)return!1;$(`${Playbar.id} #currentSongInfo`).html(`<b>${Storage.getSongName(songlist.list[e].file.name)}</b> (${songlist.list[e].file.name})`),this.stop(),Playbar.show(),Playbar.graph.load(songlist.list[e].url),e>=9*(this.selectedPage+1)&&this.nextPage(),e<9*this.selectedPage&&this.prevPage(),$(`#page div.col-4[name=placeholder_${this.selectedSongIndex}] .card`).removeClass("selected"),$(`#page div.col-4[name=placeholder_${e%9}] .card`).addClass("selected"),this.selectedSongIndex=e,Playbar.updateButtonState(!1)}selectPage(e){if(1==this.pagecount)return!1;e<0?this.selectedPage=this.pagecount-1:e>this.pagecount-1?this.selectedPage=0:this.selectedPage=e,this.update()}selectPlaceholder(e){if(e<0||e>9)return!1;this.selectSong(e+9*this.selectedPage)}play(){if(this.disabled)return!1;$("#btn_play").text("pause_circle_filled"),$("#btn_play").removeClass("stopped").removeClass("paused").addClass("playing"),Playbar.graph.play()}playpause(){if(this.disabled)return!1;console.log("playpause"),Playbar.graph.isPlaying()?this.pause():this.play()}stop(){$("#btn_play").text("play_circle_filled"),$("#btn_play").removeClass("playing").removeClass("paused").addClass("stopped"),$(`#page div.col-4[name=placeholder_${this.selectedSongIndex}] .card`).removeClass("selected"),Playbar.graph.stop(),Playbar.updateTime()}pause(){if(this.disabled)return!1;$("#btn_play").text("play_circle_filled"),$("#btn_play").removeClass("playing").addClass("paused"),Playbar.graph.pause()}setVolume(e){Playbar.graph.setVolume(e/100);let t="";0==e&&(t="volume_off"),e>0&&(t="volume_mute"),e>49&&(t="volume_down"),e>74&&(t="volume_up"),$("#volumeText").html(`<i class="material-icons">${t}</i>&nbsp;${e}%`)}nextSong(){this.selectSong(this.selectedSongIndex+1)}prevSong(){this.selectSong(this.selectedSongIndex-1)}toggleLoop(){Playbar.graph.loop?$(`${Playbar.id} .controlbtn#loop`).removeClass("selected"):$(`${Playbar.id} .controlbtn#loop`).addClass("selected"),Playbar.graph.loop=!Playbar.graph.loop}toggleAutoplay(){Playbar.graph.autoplay?$(`${Playbar.id} .controlbtn#autoplay`).removeClass("selected"):$(`${Playbar.id} .controlbtn#autoplay`).addClass("selected"),Playbar.graph.autoplay=!Playbar.graph.autoplay}nextPage(){this.selectPage(this.selectedPage+1)}prevPage(){this.selectPage(this.selectedPage-1)}}class Playbar{static convertSeconds(e){e=Math.round(1e3*e);let t=new Date(e),a={h:(t.getHours()-1).toString(),m:t.getMinutes().toString(),s:t.getSeconds().toString()};for(let e in a)1==a[e].length&&(a[e]="0"+a[e]);return[a.h,a.m,a.s]}static getPercent(e,t){return 0==e||0==t?0:Math.round(e/t*100)}static init(){this.visible=!1,this.id="#playbar",this.graph=WaveSurfer.create({container:`${Playbar.id} #waveform .graph`,waveColor:"#ccc",progressColor:"black"}),this.graph.autoplay=!1,this.graph.loop=!1,this.graph.on("ready",function(){Playbar.updateButtonState(!0),Playbar.graph.autoplay&&songlist.play(),Playbar.updateTime()}),this.graph.on("audioprocess",function(){Playbar.updateTime()}),this.graph.on("seek",function(){Playbar.updateTime()}),this.graph.on("finish",function(){Playbar.graph.loop?songlist.play():songlist.nextSong()})}static show(e=500,t="snap"){if(this.visible)return!1;$(this.id).transition({y:"0px"},e,t),this.visible=!0}static hide(e=1e3,t="snap"){if(songlist.stop(),songlist.selectedSongIndex=-1,!this.visible)return!1;$(this.id).transition({y:"300px"},e,t),this.visible=!1}static updateButtonState(e){e?($("#playbar #btn_play").removeClass("disabled"),$("#playbar #btn_stop").removeClass("disabled"),songlist.disabled=!1):($("#playbar #btn_play").addClass("disabled"),$("#playbar #btn_stop").addClass("disabled"),songlist.disabled=!0)}static updateTime(e){let t=Playbar.convertSeconds(Playbar.graph.getCurrentTime()),a=Playbar.convertSeconds(Playbar.graph.getDuration()),s=Playbar.getPercent(this.graph.getCurrentTime(),this.graph.getDuration());return a[0]>0?$(`${Playbar.id} #waveform .timer`).text(`${t[0]}:${t[1]}:${t[2]} / ${a[0]}:${a[1]}:${a[2]} (${s}%)`):$(`${Playbar.id} #waveform .timer`).text(`${t[1]}:${t[2]} / ${a[1]}:${a[2]} (${s}%)`),!0}static setupKeys(){this.keybindings={playpause:{key:"NumpadEnter",event:"songlist.playpause()"},stop:{key:"NumpadAdd",event:"songlist.stop()"},pageUp:{key:"ArrowUp",event:"songlist.nextPage()"},pageDown:{key:"ArrowDown",event:"songlist.prevPage()"},prevSong:{key:"ArrowLeft",event:"songlist.prevSong()"},nextSong:{key:"ArrowRight",event:"songlist.nextSong()"},Placeholder1:{key:"Numpad7",event:"songlist.selectPlaceholder(7)"},Placeholder2:{key:"Numpad8",event:"songlist.selectPlaceholder(8)"},Placeholder3:{key:"Numpad9",event:"songlist.selectPlaceholder(9)"},Placeholder4:{key:"Numpad4",event:"songlist.selectPlaceholder(4)"},Placeholder5:{key:"Numpad5",event:"songlist.selectPlaceholder(5)"},Placeholder6:{key:"Numpad6",event:"songlist.selectPlaceholder(6)"},Placeholder7:{key:"Numpad1",event:"songlist.selectPlaceholder(1)"},Placeholder8:{key:"Numpad2",event:"songlist.selectPlaceholder(2)"},Placeholder9:{key:"Numpad3",event:"songlist.selectPlaceholder(3)"}},$("body").keyup(function(e){songlist.keylisten&&Playbar.keyPress(e.originalEvent.code)})}static keyPress(key){for(let name in this.keybindings)if(key==this.keybindings[name].key)return eval(this.keybindings[name].event),!0;return console.log(key),!1}}class Storage{static init(){if(this.enabled=!1,void 0===Storage)return!1;this.enabled=!0,localStorage.songnames||(localStorage.songnames="{}"),this.json=JSON.parse(localStorage.songnames)}static update(){localStorage.songnames=JSON.stringify(this.json)}static getSongName(e){return e in Storage.json?Storage.json[e]:e}static setSongName(e,t){this.json[e]=t,this.update()}}class RenameModal{static open(){songlist.keylisten=!1,$("#mod_rename #txt_newname").val($("#page div.col-4[name="+this.selected.placeholder+"] .card-title").text()),$("#mod_rename").modal("show")}static onclose(e){if(e){console.log(this.selected);let e=$("#mod_rename #txt_newname").val();if(""==e)return!1;Storage.setSongName(this.selected.filename,e),$("#page div.col-4[name="+this.selected.placeholder+"] .card-title").text(e),songlist.keylisten=!0}}}const emptyCardText="Click to add audio";songlist=new SongList,$(function(){window.File&&window.FileReader&&window.FileList&&window.Blob?console.log("Browser is fully supported."):$("body").css({margin:"8px","background-color":"#ffbcbc"}).html("<h1>We're sorry</h1><p>Your browser does not support the necessary functions to run this program. Try using another browser.</p>"),Storage.init(),songlist.init(),Playbar.init(),Playbar.setupKeys()});